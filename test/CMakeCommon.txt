
function(add_ispcs ISPC_OBJECTS FILES)
    set(OBJECT_FILES "")
    foreach(SOURCE_FILE IN LISTS FILES)
        string(REPLACE ".ispc" ".ispc.o" OBJECT_FILE ${SOURCE_FILE})
        get_filename_component(OBJECT_FILE ${OBJECT_FILE} NAME)
        set(OBJECT_FILE ${CMAKE_CURRENT_BINARY_DIR}/${OBJECT_FILE})
        set(OBJECT_FILES "${OBJECT_FILES};${OBJECT_FILE}")
        string(REPLACE ".ispc" ".ispc.h" HEADER_FILE ${SOURCE_FILE})
        message("header:${HEADER_FILE}")
        add_custom_command(OUTPUT ${OBJECT_FILE}
            COMMAND ${ISPC_BIN} ${SOURCE_FILE} -o ${OBJECT_FILE} --target=${ISPC_TARGET} --arch=${ISPC_ARCH} --cpu=${ISPC_CPU} -h ${HEADER_FILE}
            WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
    endforeach()
    set(${ISPC_OBJECTS} ${OBJECT_FILES} PARENT_SCOPE)
endfunction(add_ispcs)

function(add_ispcs_header_directory ISPC_OBJECTS FILES HEADER_DIRECTORY)
    set(OBJECT_FILES "")
    foreach(SOURCE_FILE IN LISTS FILES)
        string(REPLACE ".ispc" ".ispc.o" OBJECT_FILE ${SOURCE_FILE})
        get_filename_component(OBJECT_FILE ${OBJECT_FILE} NAME)
        set(OBJECT_FILE ${CMAKE_CURRENT_BINARY_DIR}/${OBJECT_FILE})
        set(OBJECT_FILES "${OBJECT_FILES};${OBJECT_FILE}")
        get_filename_component(FILENAME ${SOURCE_FILE} NAME)
        string(REPLACE ".ispc" ".ispc.h" HEADER_FILE ${FILENAME})
        set(HEADER_FILE ${HEADER_DIRECTORY}${HEADER_FILE})
        message("header:${HEADER_FILE}")
        add_custom_command(OUTPUT ${OBJECT_FILE}
            COMMAND ${ISPC_BIN} ${SOURCE_FILE} -o ${OBJECT_FILE} --target=${ISPC_TARGET} --arch=${ISPC_ARCH} --cpu=${ISPC_CPU} -h ${HEADER_FILE}
            WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})
    endforeach()
    set(${ISPC_OBJECTS} ${OBJECT_FILES} PARENT_SCOPE)
endfunction(add_ispcs_header_directory)

